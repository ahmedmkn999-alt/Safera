<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>صَفّارة | نتائج حية ومباريات اليوم</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <div class="logo">⚽ صَفّارة</div>
        <nav>
            <button onclick="fetchMatches('yesterday')">الأمس</button>
            <button onclick="fetchMatches('today')" class="active" id="today-btn">اليوم</button>
            <button onclick="fetchMatches('tomorrow')">الغد</button>
        </nav>
    </header>

    <main id="matches-container">
        <p class="msg">جاري تحميل مباريات اليوم من السيرفر...</p>
    </main>

    <script>
        // تم إضافة مفتاحك الشخصي هنا بنجاح
        const API_KEY = '4587f742d3b24cbc92e94555f386504b';

        async function fetchMatches(day) {
            const container = document.getElementById('matches-container');
            container.innerHTML = '<p class="msg">جاري تحديث البيانات الحية...</p>';
            
            let date = new Date();
            if(day === 'yesterday') date.setDate(date.getDate() - 1);
            if(day === 'tomorrow') date.setDate(date.getDate() + 1);
            const dateStr = date.toISOString().split('T')[0];

            try {
                const response = await fetch(`https://api.football-data.org/v4/matches?date=${dateStr}`, {
                    headers: { 'X-Auth-Token': API_KEY }
                });
                const data = await response.json();
                displayMatches(data.matches);
            } catch (error) {
                container.innerHTML = '<p class="msg">عذراً، حدث خطأ في جلب البيانات. تأكد من استهلاك الحصة المجانية.</p>';
            }
        }

        function displayMatches(matches) {
            const container = document.getElementById('matches-container');
            if (!matches || matches.length === 0) {
                container.innerHTML = '<p class="msg">لا توجد مباريات مجدولة لهذا التاريخ.</p>';
                return;
            }

            container.innerHTML = matches.map(m => `
                <div class="match-card">
                    <div class="team">${m.homeTeam.name}</div>
                    <div class="score-area">
                        <div class="score">${m.score.fullTime.home ?? 0} - ${m.score.fullTime.away ?? 0}</div>
                        <div class="status ${m.status === 'IN_PLAY' || m.status === 'LIVE' ? 'live' : ''}">
                            ${m.status === 'IN_PLAY' || m.status === 'LIVE' ? '● مباشر' : m.utcDate.split('T')[1].substring(0,5)}
                        </div>
                    </div>
                    <div class="team text-left">${m.awayTeam.name}</div>
                    ${(m.status === 'IN_PLAY' || m.status === 'LIVE' || m.status === 'FINISHED') ? 
                    `<a href="watch.html?id=${m.id}" class="watch-btn">شاهد البث / الملخص</a>` : ''}
                </div>
            `).join('');
        }

        fetchMatches('today');
        // تحديث تلقائي كل دقيقة
        setInterval(() => fetchMatches('today'), 60000);
    </script>
</body>
</html>
